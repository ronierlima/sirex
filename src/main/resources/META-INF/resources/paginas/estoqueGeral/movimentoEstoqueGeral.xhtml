<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	template="/WEB-INF/layout/template.xhtml">

	<ui:define name="title">Movimentação de Estoque</ui:define>

	<ui:define name="breadcrumb">
		<f:metadata>
			<f:viewParam name="paginaAnterior" value="/paginas/estoqueGeral/listarEstoqueGeral.xhtml" />
			<f:viewParam name="homeOutcome" value="/paginas/principal.xhtml" />
			<f:viewParam name="value" value="Estoque,Incluir Estoque" />
			<f:viewParam name="outcome" value="/paginas/estoqueGeral/movimentoEstoqueGeral" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<h:form prependId="false">

			<div class="grid">
				<div class="col-12 md:col-12">
					<div class="card ui-fluid">
						<h5>Cadastro de Estoque</h5>
						<div class="formgrid grid">
						
						<div class="field col-12 md:col-2">						
								<p:outputLabel for="categoria" value="Categoria" />
								<p:selectOneMenu converter="omnifaces.SelectItemsConverter" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									filter="true" filterMatchMode="contains" id="categoria"
									value="#{cadastroEstoqueGeralBean.entradaEstoque.produto.categoria}" required="true"
									requiredMessage="A seleção do item é obrigatória!">
									<p:ajax listener="#{cadastroEstoqueGeralBean.onCategoriaChange}" update="marca,item"/>
									<f:selectItem itemLabel="Selecione a Categoria" />
									<f:selectItems value="#{cadastroEstoqueGeralBean.categoriasAtivas}"
										var="categoria" itemValue="#{categoria}"
										itemLabel="#{categoria.descricao}" />
								</p:selectOneMenu>
							</div>
							
							<div class="field col-12 md:col-4">
								<p:outputLabel for="marca" value="Marca" />
								<p:selectOneMenu converter="omnifaces.SelectItemsConverter" 
									filter="true" filterMatchMode="contains" id="marca" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									value="#{cadastroEstoqueGeralBean.entradaEstoque.produto.marca}" required="true"
									requiredMessage="A seleção do item é obrigatória!">
									<p:ajax listener="#{cadastroEstoqueGeralBean.onMarcaChange}" update="item" />	
									<f:selectItem itemLabel="Selecione a Marca" />
									<f:selectItems value="#{cadastroEstoqueGeralBean.marcasAtivas}"
										var="marca" itemValue="#{marca}"
										itemLabel="#{marca.descricao}" />
								</p:selectOneMenu>
								<p:tooltip for="marca">Selecione a Categoria para Listar as Marcas</p:tooltip>
							</div>
						
							<div class="field ui-lg-6 ui-sm-12 ui-g-nopad">
								<p:outputLabel for="item" value="Produto" />
								<p:selectOneMenu converter="omnifaces.SelectItemsConverter" 
									filter="true" filterMatchMode="contains" id="item" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									value="#{cadastroEstoqueGeralBean.entradaEstoque.produto}" required="true"
									requiredMessage="A seleção do item é obrigatória!">
									<f:selectItem itemLabel="Selecione o Produto" />
									<f:selectItems value="#{cadastroEstoqueGeralBean.produtosAtivos}"
										var="produto" itemValue="#{produto}" itemDescription="#{produto.descricao}"
										itemLabel="#{produto.descricaoReduzida}"/>
								</p:selectOneMenu>
								<p:tooltip for="item">Selecione a Marca para Listar os Produtos</p:tooltip>
							</div>
							
							
							
							<div class="field col col-12 md:col-2">
								<p:outputLabel for="codigo" value="Código Externo"/>
								<p:inputText value="#{cadastroEstoqueGeralBean.entradaEstoque.codigoExterno}" 
									maxlength="50" style="text-transform:uppercase" id="codigo" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									type="text" required="true" requiredMessage="O Código Externo é Obrigatório!" />
							</div>

							<div class="field col col-12 md:col-3">
								<p:outputLabel for="lote" value="Lote"/>
								<p:inputText value="#{cadastroEstoqueGeralBean.entradaEstoque.loteProduto.descricao}"
									maxlength="50" style="text-transform:uppercase" id="lote" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									type="text"/>
							</div>
														
							<div class="field col col-12 md:col-2">
								<p:outputLabel for="dtlote" value="Data de Validade do Lote"/>
								<p:calendar id="dtlote" mindate="today" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
										value="#{cadastroEstoqueGeralBean.entradaEstoque.loteProduto.dataValidade}"
										inputStyle="width:100%" yearRange="0:+100" navigator="true" mask="true" pattern="dd/MM/yyyy" />
							</div>

							<div class="field col col-12 md:col-2">
								<p:outputLabel for="quantidade" value="Quantidade" />
								<p:inputNumber modifyValueOnWheel="false"
									value="#{cadastroEstoqueGeralBean.entradaEstoque.quantidade}"
									maxlength="5" maxValue="99999" thousandSeparator=""
									decimalPlaces="0"
									disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									id="quantidade" required="true"
									requiredMessage="A quantidade é obrigatória!" />
							</div>
							
							<div class="field col col-12 md:col-3">
								<p:outputLabel for="valor" value="Valor Unitário" />
								<p:inputNumber symbol="R$ " decimalSeparator="," thousandSeparator="." value="#{cadastroEstoqueGeralBean.entradaEstoque.valorUnitario}" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}" id="valor" required="true" requiredMessage="O valor unitário é obrigatório!" />
							</div>

							<div class="field col col-12 md:col-12">
								<p:outputLabel for="obs" value="Observações Gerais" />
								<p:inputTextarea id="obs" disabled="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
									value="#{cadastroEstoqueGeralBean.entradaEstoque.observacoes}"
									maxlength="250" counter="disp"
									counterTemplate="{0} caracteres restantes." />
								<h:outputText id="disp" class="block" />
							</div>

							<p:outputPanel class="field col col-12 md:col-12" rendered="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}">
								<p:outputLabel for="mtbx" value="Motivo da Baixa" />
								<p:inputTextarea id="mtbx" required="#{!cadastroEstoqueGeralBean.entradaEstoque.novo}"
								    requiredMessage="O motivo da baixa é obrigatório para prosseguir!"
									value="#{cadastroEstoqueGeralBean.entradaEstoque.motivoInativacao}"
									maxlength="250" counter="dispbx"
									counterTemplate="{0} caracteres restantes." />
								<h:outputText id="dispbx" class="block" />
							</p:outputPanel>

						</div>
					</div>

					<div align="center">
						<div class="col-12 md:col-5">
							<p:commandButton value="Salvar" procces="@form" icon="pi pi-save" action="#{cadastroEstoqueGeralBean.salvar}"
								styleClass="mr-2 mb-2 ui-button-success" style="background-color:#48543d" update="@form">
									<p:confirm header="Confirmação" message="#{cadastroEstoqueGeralBean.mensagemSalvar}" icon="pi pi-exclamation-triangle" />
							</p:commandButton>
							
							<p:commandButton value="Salvar e Continuar" procces="@form" icon="pi pi-save" action="#{cadastroEstoqueGeralBean.salvarEContinuar}"
								styleClass="mr-2 mb-2 ui-button-success" update="@form" style="background-color:#5db311"
								pt:data-tooltip="Use esta opção para salvar o registro e continuar adicionando novos itens">
									<p:confirm header="Confirmação" message="#{cadastroEstoqueGeralBean.mensagemSalvar}" icon="pi pi-exclamation-triangle" />
							</p:commandButton>
							
							<p:commandButton value="Limpar" styleClass="ui-button-info" global="false"
								process="@this" update="@form" action="#{cadastroEstoqueGeralBean.inicializar}" icon="pi pi-trash" />
							
						</div>
					</div>					

				</div>
			</div>

		</h:form>
	</ui:define>

</ui:composition>