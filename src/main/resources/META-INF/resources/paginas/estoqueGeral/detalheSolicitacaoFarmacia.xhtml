<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/layout/template.xhtml">

	<ui:define name="title">Detalhe da Solicitação</ui:define>
	
	<ui:define name="breadcrumb">
		<f:metadata>
			<f:viewParam name="homeOutcome" value="/paginas/principal" />
			<f:viewParam name="value" value="Estoque Geral,Solicitações da Farmácia" />
			<f:viewParam name="outcome" value="/paginas/estoqueGeral/listarSolicitacoesFarmacia"/>
		</f:metadata>
	</ui:define>

	<ui:define name="content">
	
		<h:form prependId="false">
			<div class="grid">
				<div class="col-12 md:col-12">
					<div class="card ui-fluid">
						
						<h5>
						
						<p:outputLabel value="Detalhes da Solicitação" style="font-size:19px"/>
												
						</h5>						
						
						<p:outputPanel styleClass="formgrid grid" rendered="#{acoesSolicitacaoFarmaciaBean.solicitacao.id!=null}">

							<div class="field col-12 md:col-2">						
								<p:outputLabel value="Código da Solicitação:" style="font-size:16px"/>								
								<p:outputLabel value=" #{acoesSolicitacaoFarmaciaBean.solicitacao.codigoSolicitacao}" style="font-weight: bold;font-size:16px;margin-left:5px"/>
							</div>
							
							<div class="field col-12 md:col-2">						
								<p:outputLabel value="Solicitante: " style="font-size:16px"/>								
								<p:outputLabel value="#{acoesSolicitacaoFarmaciaBean.solicitacao.usuarioInclusao.nome}" style="font-weight: bold;font-size:16px;margin-left:5px"/>
							</div>
							
							<div class="field col-12 md:col-2">						
								<p:outputLabel value="Status da Solicitação: " style="font-size:16px"/>								
								<p:outputLabel value="#{acoesSolicitacaoFarmaciaBean.solicitacao.statusSolicitacao}" style="font-weight: bold;font-size:16px;margin-left:5px"/>
							</div>	
							
							<div class="field col-12 md:col-3">						
								<p:outputLabel value="Data-hora da Solicitação:" style="font-size:16px"/>								
								<p:outputLabel value="#{acoesSolicitacaoFarmaciaBean.solicitacao.dataInclusao}" style="font-weight: bold;font-size:16px;margin-left:5px">
									<f:convertDateTime timeZone="GMT-03:00" dateStyle="long" pattern="dd/MM/yyyy - HH:mm" />
								</p:outputLabel>
							</div>												

						</p:outputPanel>						

						<div class="grid table-demo">
							<div class="col-12">
								<div class="card">

									<p:dataTable id="dtitens" widgetVar="itemDT" var="item" style="text-align:center!important"
										value="#{acoesSolicitacaoFarmaciaBean.solicitacao.itensDaSolicitacao}" selection="#{acoesSolicitacaoFarmaciaBean.itensSelecionados}" reflow="true"
										rowKey="#{item.id}" emptyMessage="Nenhum Produto Incluído" selectionMode="multiple" selectionRowMode="none">														           							

										<f:facet name="header">
											<div align="center" class="ui-lg-12 ui-sm-12">
												<span style="font-weight: bold">PRODUTOS DA SOLICITAÇÃO</span>
											</div>
										</f:facet>
										
										<f:facet name="footer">

										<div class="grid">
											<div class="col-12 md:col-2">
												<p:commandButton value="Aprovar Selecionados"
													icon="pi pi-check" process="@this"
													action="#{acoesSolicitacaoFarmaciaBean.aprovarItensSelecionados}"
													update="@form btnSalvar" styleClass="ui-button-success"/>
											</div>
											
											<div class="col-12 md:col-2">
												<p:commandButton value="Reprovar Selecionados"
													icon="pi pi-times" process="@this"
													action="#{acoesSolicitacaoFarmaciaBean.recusarItensSelecionados}"
													update="dlgparcial btnSalvar" styleClass="ui-button-danger"/>	
																																						
											</div>
											
											</div>

										</f:facet>
										
										<p:ajax event="toggleSelect" process="@this"/>
										<p:ajax event="rowSelectCheckbox" process="@this"/>
										<p:ajax event="rowUnselectCheckbox" process="@this"/>
										
										<p:column selectionMode="multiple" style="width:10px!important;text-align:center" />

										<p:column headerText="Tipo" style="text-align: center;"
											styleClass="col-12 md:col-3">
											<h:outputText value="#{item.produto.categoria.descricao}" />
										</p:column>

										<p:column headerText="Produto" style="text-align: center;"
											styleClass="col-12 md:col-7">
											<h:outputText value="#{item.produto.descricao}" />
										</p:column>
										
										<p:column headerText="Marca" style="text-align: center;"
											styleClass="col-12 md:col-2">
											<h:outputText value="#{item.produto.marca.descricao}" />
										</p:column>

										<p:column headerText="Quantidade Solicitada" style="text-align: center;" styleClass="col-12 md:col-2">											
											<h:outputText value="#{item.quantidadeSolicitada}"/>												
										</p:column>
										
										<p:column headerText="Quantidade Aprovada" style="text-align: center;" styleClass="col-12 md:col-2">											
											<h:outputText value="#{item.quantidadeAprovada}"/>												
										</p:column>
										
										<p:column headerText="Status do Item" style="text-align: center;" styleClass="col-12 md:col-2">											
											<h:outputText value="#{item.statusSolicitacaoItem.descricao}" rendered="#{!item.pendente}"/>												
										</p:column>
										
										<p:column headerText="Justificativa" style="text-align: center;" styleClass="col-12 md:col-2">											
											<p:commandButton icon="pi pi-eye" process="@this" title="Visualizar justificativa" disabled="#{item.justificativaStatus eq null}"
											action="#{acoesSolicitacaoFarmaciaBean.openDlgJustificativa(item)}" update="dlgjustificativa">
												<f:setPropertyActionListener value="#{item}" target="#{acoesSolicitacaoFarmaciaBean.itemSelecionado}"/>
											</p:commandButton>																																	
										</p:column>

										<p:column headerText="Ações" style="text-align: center;" styleClass="col-12 md:col-4">																					
																
											<p:commandButton title="Aprovar" action="#{acoesSolicitacaoFarmaciaBean.aprovar(item)}" styleClass="mr-2 mb-2 ui-button-success" process="@this" update="dtitens btnSalvar" icon="pi pi-check"/>
											<p:commandButton title="Recusar" action="#{acoesSolicitacaoFarmaciaBean.recusarItem(item)}" styleClass="mr-2 mb-2 ui-button-danger" update="dlgRep btnSalvar" process="@this"  icon="pi pi-times">
												<f:setPropertyActionListener value="#{item}" target="#{acoesSolicitacaoFarmaciaBean.itemSelecionado}" />
											</p:commandButton>
											<p:commandButton title="Aprovar Parcialmente" action="#{acoesSolicitacaoFarmaciaBean.aprovarPacialmenteItem(item)}"  styleClass="mr-2 mb-2 ui-button-warning" process="@this" update="dlgparcial btnSalvar" icon="fa fa-fw fa-list"/>
																				
										</p:column>

									</p:dataTable>
								</div>
							</div>
						</div>						
						
						<div align="center">
						
						<p:panelGrid columns="2" styleClass="ui-lg-3" style="margin-top:10px;" >
							
								<p:commandButton value="Salvar" id="btnSalvar" icon="pi pi-save" process="@this"
									action="#{acoesSolicitacaoFarmaciaBean.salvar}" disabled="#{acoesSolicitacaoFarmaciaBean.solicitacao.existeItemPendente or acoesSolicitacaoFarmaciaBean.solicitacao.id==null}" update="@form">
									<p:confirm header="Confirmação"
											message="Confirma a gravação dos dados informados?"
											icon="pi pi-exclamation-triangle" />	
								</p:commandButton>	
							
								<p:button outcome="/paginas/estoqueGeral/listarSolicitacoesFarmacia"
									value="Voltar" icon="pi pi-arrow-left"
									styleClass="ui-button-danger" />							

						</p:panelGrid>
						
						</div>
						
					</div>
				</div>
			</div>
			
			<p:dialog header="Reprovar Solicitação" id="dlgRep" showEffect="fade" modal="true" widgetVar="dlgReprovar" responsive="true">
			
                            <p:outputPanel id="pnljustificativa" class="ui-fluid">
                                <p:outputPanel> 
                                    <div class="field">
                                        <p:outputLabel for="justificativa">Justificativa</p:outputLabel>
                                        <p:inputTextarea required="true" maxlength="250" counter="display" counterTemplate="{0} caracteres restantes." requiredMessage="Uma justificativa para reprovação deve ser informada!" id="justificativa" value="#{acoesSolicitacaoFarmaciaBean.itemSelecionado.justificativaStatus}" />
                                        <br/>
									<h:outputText id="display"/>
                                    </div> 
                                </p:outputPanel>
                            </p:outputPanel>

                            <f:facet name="footer">
                            	 <div align="center">
                                <p:commandButton value="Salvar" icon="pi pi-check" actionListener="#{acoesSolicitacaoFarmaciaBean.fecharDlgRecusa}" styleClass="ui-button-success" update="dtitens pnljustificativa btnSalvar" process="pnljustificativa @this" />                                
                                <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dlgReprovar').hide()" styleClass="ui-button-danger" process="@this"/>
                            	</div>
                            </f:facet>
                        </p:dialog> 
                        
                        <p:dialog header="Aprovar Parcialmente" id="dlgparcial" showEffect="fade" modal="true" widgetVar="dlgParcial" responsive="true">
                            <p:outputPanel id="pnlparcial" class="ui-fluid">                                                                
                                    <div class="field">
                                        <p:outputLabel for="qtdsol">Quantidade Solicitada</p:outputLabel>
                                        <p:inputText id="qtdsol" value="#{acoesSolicitacaoFarmaciaBean.itemSelecionado.quantidadeSolicitada}" disabled="true" readonly="true"/>
                                    </div>
                                    
                                    <div class="field">
                                        <p:outputLabel for="qtdap">Quantidade Aprovada</p:outputLabel>
                                        <p:inputNumber modifyValueOnWheel="false" minValue="0" decimalPlaces="0" thousandSeparator="" id="qtdap" value="#{acoesSolicitacaoFarmaciaBean.itemSelecionado.quantidadeAprovada}" required="true" requiredMessage="Informe a quantidade a ser liberada!"/>
                                    </div>
                                    
                                    <div class="field">
                                        <p:outputLabel for="justlib">Justificativa para Liberação Parcial</p:outputLabel>
                                        <p:inputTextarea maxlength="250" counter="disp" counterTemplate="{0} caracteres restantes." id="justlib" value="#{acoesSolicitacaoFarmaciaBean.itemSelecionado.justificativaStatus}" required="true" requiredMessage="A justificativa para liberação parcial é obrigatória!"/>
                                    	<br/>
										<h:outputText id="disp"/>
                                    </div>
                                    
                            </p:outputPanel>

                            <f:facet name="footer">
                               <div align="center">
                                <p:commandButton value="Salvar" icon="pi pi-check" actionListener="#{acoesSolicitacaoFarmaciaBean.fecharDlgParcial}" styleClass="ui-button-success" update="dtitens pnlparcial btnSalvar" process="pnlparcial @this" />                                
                            	<p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dlgParcial').hide()" styleClass="ui-button-danger" process="@this"/>
                            	</div>
                            </f:facet>
                      </p:dialog> 
                      
                      
                      <p:dialog header="Reprovar Solicitação" id="dlgRepItens" showEffect="fade" modal="true" widgetVar="dlgReprovarItens" responsive="true">
			
                            <p:outputPanel id="pnljustitens" class="ui-fluid">
                                <p:outputPanel> 
                                    <div class="field">
                                        <p:outputLabel for="just">Justificativa</p:outputLabel>
                                        <p:inputTextarea id="just" required="true" maxlength="250" counter="dsp" counterTemplate="{0} caracteres restantes." requiredMessage="Uma justificativa para reprovação deve ser informada!" value="#{acoesSolicitacaoFarmaciaBean.itemSelecionado.justificativaStatus}" />
                                        <br/>
									<h:outputText id="dsp"/>
                                    </div> 
                                </p:outputPanel>
                            </p:outputPanel>

                            <f:facet name="footer">
                            	 <div align="center">                                
                                <p:commandButton value="Salvar" icon="pi pi-check" actionListener="#{acoesSolicitacaoFarmaciaBean.fecharDlgRecusaItensSelecionados}" styleClass="ui-button-success" update="dtitens pnljustitens btnSalvar" process="pnljustitens @this" />
                                <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dlgReprovarItens').hide()" styleClass="ui-button-danger" process="@this"/>
                            	</div>
                            </f:facet>
                        </p:dialog>
                      
                      <p:dialog header="Justificativa" id="dlgjustificativa" showEffect="fade" modal="true" widgetVar="dlgJustificativa" responsive="true">
                            <p:outputPanel id="pnljust" class="ui-fluid">                                                                
                                    <div class="field">                                       
                                        <h:outputText value="#{acoesSolicitacaoFarmaciaBean.itemSelecionado.justificativaStatus}" />
                                    </div>                                    
                            </p:outputPanel>

                            <f:facet name="footer">
                               <div align="center">
                               <p:commandButton value="Fechar" icon="pi pi-times" onclick="PF('dlgJustificativa').hide()" styleClass="ui-button-danger" process="@this"/>
                            	</div>
                            </f:facet>
                      </p:dialog>

		</h:form>
		
	</ui:define>

</ui:composition>